<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">

  <head>
  
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Docker를 이용한 deep learning 개발 환경 구축 (2) &middot; Yu's Tech 블로그
    
  </title>

  <!-- BOOTSTRAP -->
  <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>

  <!-- CODE BLOCK FONT -->
  <link href="http://cdn.jsdelivr.net/gh/joungkyun/font-d2coding/d2coding.css" rel="stylesheet" type="text/css">

  <!-- SCROLLSPY-->
  <script src="https://unpkg.com/scrollnav@3.0.2/dist/scrollnav.min.umd.js"></script>
  <link rel="stylesheet" href="/assets/css/style.css">

  
  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/lanyon.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700|PT+Sans:400">

    <!-- syntax.css -->
  <link rel="stylesheet" href="/assets/css/syntax.css">

  <!-- font -->
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css2?family=Nanum+Gothic&display=swap" rel="stylesheet">
  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">

  <!-- Google Analytics -->
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-146052-15', 'getpoole.com');
    ga('send', 'pageview');
  </script>

</head>

  <!--
<script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>
-->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
    }
  });
</script>
<script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>



  <body>

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p>You will never know until you try.</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item" href="/">Home <small class="text-info">23</small></a>

    

    <!-- 
    
      
        
      
    
      
        
          <a class="sidebar-nav-item" href="/about/">About</a>
        
      
    
      
    
      
    
      
    
      
        
          <a class="sidebar-nav-item" href="/category/Algorithm/index.html">Algorithm</a>
        
      
    
      
        
          <a class="sidebar-nav-item" href="/category/Deep%20learning/index.html">Deep learning</a>
        
      
    
      
        
          <a class="sidebar-nav-item" href="/category/Docker/index.html">Docker</a>
        
      
    
      
        
          <a class="sidebar-nav-item" href="/category/HPC/index.html">HPC</a>
        
      
    
      
        
          <a class="sidebar-nav-item" href="/category/Lecture/index.html">Lecture</a>
        
      
    
      
        
          <a class="sidebar-nav-item" href="/category/Mongodb/index.html">Mongodb</a>
        
      
    
      
        
          <a class="sidebar-nav-item" href="/category/OpenCL/index.html">OpenCL</a>
        
      
    
      
        
          <a class="sidebar-nav-item" href="/category/Operating%20system/index.html">Operating system</a>
        
      
    
      
        
          <a class="sidebar-nav-item" href="/category/Python/index.html">Python</a>
        
      
    
      
        
          <a class="sidebar-nav-item" href="/category/Spark/index.html">Spark</a>
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
 -->
    
      <a class = "sidebar-nav-item " href="/category/Python/index.html">Python <small class="text-info">3</small></a>  
    <!--<a class="sidebar-nav-item" href="/category/Python/index.html">Python</a>  <small class="text-muted">3</small>-->
    
      <a class = "sidebar-nav-item " href="/category/Mongodb/index.html">Mongodb <small class="text-info">1</small></a>  
    <!--<a class="sidebar-nav-item" href="/category/Mongodb/index.html">Mongodb</a>  <small class="text-muted">1</small>-->
    
      <a class = "sidebar-nav-item " href="/category/Spark/index.html">Spark <small class="text-info">1</small></a>  
    <!--<a class="sidebar-nav-item" href="/category/Spark/index.html">Spark</a>  <small class="text-muted">1</small>-->
    
      <a class = "sidebar-nav-item " href="/category/Algorithm/index.html">Algorithm <small class="text-info">4</small></a>  
    <!--<a class="sidebar-nav-item" href="/category/Algorithm/index.html">Algorithm</a>  <small class="text-muted">4</small>-->
    
      <a class = "sidebar-nav-item " href="/category/Deep learning/index.html">Deep learning <small class="text-info">1</small></a>  
    <!--<a class="sidebar-nav-item" href="/category/Deep learning/index.html">Deep learning</a>  <small class="text-muted">1</small>-->
    
      <a class = "sidebar-nav-item " href="/category/OpenCL/index.html">OpenCL <small class="text-info">1</small></a>  
    <!--<a class="sidebar-nav-item" href="/category/OpenCL/index.html">OpenCL</a>  <small class="text-muted">1</small>-->
    
      <a class = "sidebar-nav-item " href="/category/Operating system/index.html">Operating system <small class="text-info">1</small></a>  
    <!--<a class="sidebar-nav-item" href="/category/Operating system/index.html">Operating system</a>  <small class="text-muted">1</small>-->
    
      <a class = "sidebar-nav-item " href="/category/Lecture/index.html">Lecture <small class="text-info">8</small></a>  
    <!--<a class="sidebar-nav-item" href="/category/Lecture/index.html">Lecture</a>  <small class="text-muted">8</small>-->
    
      <a class = "sidebar-nav-item " href="/category/HPC/index.html">HPC <small class="text-info">1</small></a>  
    <!--<a class="sidebar-nav-item" href="/category/HPC/index.html">HPC</a>  <small class="text-muted">1</small>-->
    
      <a class = "sidebar-nav-item " href="/category/Docker/index.html">Docker <small class="text-info">2</small></a>  
    <!--<a class="sidebar-nav-item" href="/category/Docker/index.html">Docker</a>  <small class="text-muted">2</small>-->
    
    
<!--
    <a class="sidebar-nav-item" href="https://github.com/Yujaeseo/Yujaeseo.github.io.git/archive/v1.0.0.zip">Download</a>
    <a class="sidebar-nav-item" href="https://github.com/Yujaeseo/Yujaeseo.github.io.git">GitHub project</a>
    <span class="sidebar-nav-item">Currently v1.0.0</span>
-->
  </nav>
<!--
  <div class="sidebar-item">
    <p>
      &copy; 2022. All rights reserved.
    </p>
  </div>
-->
</div>


    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">Yu's Tech 블로그</a>
            <small>프로그래밍 이야기</small>
          </h3>
        </div>
      </div>

      <div class="container content">
        <div class="post">

  <h1 class="post-title">Docker를 이용한 deep learning 개발 환경 구축 (2)</h1>
  <span class="post-date">06 Oct 2022</span>
  
    
      
        <span class="badge badge-dark">MLops</span>
      
    
      
        <span class="badge badge-dark">Deep learning</span>
      
    
      
        <span class="badge badge-dark">Machine learning</span>
      
    
      
        <span class="badge badge-dark">Docker</span>
      
    
  
  <article id="main-content" class="main-content">
    <hr />

<p><br /><br /><br /></p>

<h2 id="volume-생성"><strong>Volume 생성</strong></h2>

<p>컨테이너 안의 데이터를 보존하기 위해서는 <code class="language-plaintext highlighter-rouge">volume</code>을 생성해야 한다.  만약 volume을 생성하지 않고 컨테이너 안에서 텍스트 파일(e.g. <code class="language-plaintext highlighter-rouge">test.txt</code>)을 저장 후 실행 중인 컨테이너를 종료시켰다고 해보자. 이후 동일한 image를 사용하여 컨테이너를 재실행 했을 때, 해당  파일을 저장한 path로 가서 파일을 찾아보아도 <code class="language-plaintext highlighter-rouge">test.txt</code> 를 발견할 수 없다. 즉, 컨테이너에 mount한 volume 밖에 있는 data는 persistent한 성질을 갖지 않게 되고, 컨테이너 종료와 함께 사라지게 된다. 따라서 컨테이너의 lifecycle과 독립적으로 data를 저장하고 관리하기 위해서는 volume을 생성하고 해당 volume에 data를 저장해야한다.</p>

<p>컨테이너 실행 시 아래의 command로 volume을 생성할 수 있다.  <code class="language-plaintext highlighter-rouge">--volume host path:container path</code> 로 host의 directory (<code class="language-plaintext highlighter-rouge">./data</code>) 와 container의 directory (<code class="language-plaintext highlighter-rouge">home/jaeseo/app</code>)을 매핑하였다. 이를 통해 컨테이너는 host 내의 디렉토리를 컨테이너의 디렉토리로 사용할 수 있게 된다. 이미 존재하는 volume과 매핑할 경우에는 <code class="language-plaintext highlighter-rouge">host path</code>에 존재하는 volume의 이름을 적으면 된다. 존재하지 않는 volume의 경우에는 자동으로 생성이 된다.  특정 volume을 여러 컨테이너가 공유할 수 있는데, 해당 host의 디렉토리를 다른 컨테이너에 동일하게 매핑하면 된다.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   docker container run <span class="sb">`</span>
   <span class="nt">-it</span> <span class="sb">`</span>
   <span class="nt">--name</span> development_env_cont <span class="sb">`</span>
   <span class="nt">--volume</span> ./data:/home/jaeseo/app <span class="sb">`</span>
   development_env:1
</code></pre></div></div>

<p><br /><br /></p>

<h2 id="컨테이너를-외부와-연결"><strong>컨테이너를 외부와 연결</strong></h2>

<p>컨테이너를 외부와 연결해주기 위하서는 도커와 호스트의 IP와 포트를 바인딩해야 한다. 만약 바인딩을 하지 않고서는 컨테이너를 외부에서 접근할 수 없으며, 컨테이너에 구성한 개발 환경도 호스트에서 사용할 수 없게된다. 그래서 호스트에서 컨테이너의 어플리케이션에 접근할 수 있도록 포트 바인딩을 한다.</p>

<p><code class="language-plaintext highlighter-rouge">-p</code> 옵션을 추가하고 <code class="language-plaintext highlighter-rouge">호스트 포트:컨테이너 어플리케이션 포트</code> 의 형식으로 <code class="language-plaintext highlighter-rouge">run</code> command에 추가하면 된다. 여러개의 포트를 개방하고싶다면, <code class="language-plaintext highlighter-rouge">-p</code> 옵션을 여러 번 써서 설정한다. 필자는 jupyter notebook을 사용할 것이기 때문에, jupyter notebook이 기본적으로 사용하는 <code class="language-plaintext highlighter-rouge">8888</code> 포트를  호스트와 연결한다.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   docker container run <span class="sb">`</span>
   <span class="nt">-it</span> <span class="sb">`</span>
   <span class="nt">--name</span> development_env_cont <span class="sb">`</span>
   <span class="nt">--volume</span> ./data:/home/jaeseo/app <span class="sb">`</span>
   <span class="nt">-p</span> 8888:8888 <span class="sb">`</span>
   development_env:1
</code></pre></div></div>

<p><br /><br /></p>

<h2 id="pytorch-jupyterlab-다운로드"><strong>Pytorch, Jupyterlab 다운로드</strong></h2>

<p>머신러닝 프레임워크로 <code class="language-plaintext highlighter-rouge">Pytorch</code>를 사용할 것이기 때문에, <code class="language-plaintext highlighter-rouge">pytorch</code>와 이를 사용하기 위한 연관 패키지를 다운받는다. 컴퓨터비전과 음성처리와 관련된 데이터, 모델 및 필요한 요소들을 포함하는 <code class="language-plaintext highlighter-rouge">torchvision</code>, <code class="language-plaintext highlighter-rouge">torchaudio</code>와 함께 다운로드한다. <code class="language-plaintext highlighter-rouge">conda activate</code>를 통해 사전에 <code class="language-plaintext highlighter-rouge">dockerfile</code>에서 생성한 가상환경 (<code class="language-plaintext highlighter-rouge">test</code>)를 활성화하고 <code class="language-plaintext highlighter-rouge">conda install</code>을 해야한다는 점에 유의하자. 이후 다운로드가 완료되면 <code class="language-plaintext highlighter-rouge">conda list</code>를 통해관련 package가 다운됐는지 확인해보자.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   conda activate <span class="nb">test
   </span>conda <span class="nb">install </span><span class="nv">pytorch</span><span class="o">==</span>1.12.0 <span class="nv">torchvision</span><span class="o">==</span>0.13.0 <span class="nv">torchaudio</span><span class="o">==</span>0.12.0 <span class="nt">-c</span> pytorch
   
   conda list
</code></pre></div></div>

<p><img src="/assets/img/Lecture/Introduction to Model Serving/Introduction to Model Serving Infrastructure/image-20221014100600904.png" alt="image-20221014100600904" /></p>

<p><code class="language-plaintext highlighter-rouge">Pytorch</code>가 정상적으로 다운로드된 것을 확인한 후에, 머신러닝 개발 환경에 특화된 웹 형태의 개발 환경으로 유명한 <code class="language-plaintext highlighter-rouge">Jupyterlab</code>을 install한다. <code class="language-plaintext highlighter-rouge">Jupyterlab</code>은 기존 <code class="language-plaintext highlighter-rouge">Jupyter notebook</code>에 다중 탭 등 다양한 확장 기능을 추가해 만든 어플리케이션이다.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   conda <span class="nb">install</span> <span class="nt">-c</span> conda-forge jupyterlab
</code></pre></div></div>

<p><br /><br /></p>

<h2 id="작업-container-image로-저장"><strong>작업 container image로 저장</strong></h2>

<p>현재까지 처음에 <code class="language-plaintext highlighter-rouge">dockerfile</code>로 만들었던 이미지를 컨테이너로 생성하고 <code class="language-plaintext highlighter-rouge">Pytorch</code>와 연관 패키지와 <code class="language-plaintext highlighter-rouge">Jupyterlab</code>을 설치했다. 그리고 앞으로 머신러닝 및 딥러닝 모델 개발을 하면서 필요한 패키지가 그때그때 생길 것이고 설치하게 될것이다. 하지만, 이렇게 공들여 업데이트하고 만들어놓은 컨테이너는 컨테이너가 종료된 순간 모든 업데이트 정보가 사라지게 된다. 컨테이너에서 작업한 내용들은 컨테이너 상태로 저장되게 되고, 컨테이너를 생성한 이미지에 업데이트 되지 않기 때문이다. 다음날 다시 컨테이너를 생성하고 작업을 시작할 때마다 복잡한 설정을 일일이 해줄수도 없고 그렇다고 <code class="language-plaintext highlighter-rouge">dockerfile</code> 에 작업한 내용을 매번 다시 써서 파일을 업데이트하기도 귀찮다. Docker에서는 <code class="language-plaintext highlighter-rouge">docker commit</code> 명령어를 통해 현재 특정 container를 이미지로 다시 저장할 수 있다. 저장된 이미지는 container에서 작업했던 내용을 포함하고 있고, <code class="language-plaintext highlighter-rouge">commit</code>한 이미지를 실행시켜 작업을 편리하게 이어갈 수 있다. 호스트에서  <code class="language-plaintext highlighter-rouge">docker commit [컨테이너명] [이미지명]</code>의 형식으로 쉽게 컨테이너를 저장할 수 있다.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   docker commit development_env_cont commit_pytorch_image
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">docker images</code> 명령어를 통해 새로운 이미지가 생성된 것을 확인할 수 있다.</p>

<p><img src="/assets/img/Lecture/Introduction to Model Serving/Introduction to Model Serving Infrastructure/image-20221014162718322.png" alt="image-20221014162718322" /></p>

<p><br /><br /></p>

<h2 id="jupyterlab-실행"><strong>Jupyterlab 실행</strong></h2>

<p>호스트에서 <code class="language-plaintext highlighter-rouge">jupyterlab</code> 비밀번호를 설정하고, notebook directory를 생성한다. 아래의 명령어를 통해 <code class="language-plaintext highlighter-rouge">jupyterlab</code> 을 실행할 수 있다. 실행 포트는 이전 컨테이너 실행시에 매핑했던 <code class="language-plaintext highlighter-rouge">8888</code>을 적는다.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   jupyter lab password
   <span class="nb">mkdir </span>jupyterlab
   jupyter lab <span class="nt">--notebook-dir</span><span class="o">=</span>~/app/jupyterlab <span class="nt">--ip</span><span class="o">=</span><span class="s1">'*'</span> <span class="nt">--port</span><span class="o">=</span>8888 <span class="nt">--no-browser</span> <span class="nt">--allow-root</span>
</code></pre></div></div>

<p>호스트에서 브라우저 창을 열고 <code class="language-plaintext highlighter-rouge">http://localhost:8888</code>로 접속하면 <code class="language-plaintext highlighter-rouge">jupyterlab</code> 창이 뜨게되고, 설정한 password를 입력해 노트북을 사용할 수 있다.</p>

<p><img src="/assets/img/Lecture/Introduction to Model Serving/Introduction to Model Serving Infrastructure/image-20221014164956399.png" alt="image-20221014164956399" width="100%" height="100%" class="align-center" /></p>

  </article>

</div>

<div class="related">
  <h2>Related Posts</h2>
  <ul class="related-posts">
    
      <li>
        <h3>
          <a href="/docker/2022/10/06/Docker-deep-learning-dev-environment2/">
            Docker를 이용한 deep learning 개발 환경 구축 (2)
            <small>06 Oct 2022</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/python/2021/01/22/Python1/">
            Python Mutable, Immutable 비교
            <small>22 Jan 2021</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/docker/2022/09/04/Docker-deep-learning-dev-environment/">
            Docker를 이용한 deep learning 개발 환경 구축 (2)
            <small>04 Sep 2022</small>
          </a>
        </h3>
      </li>
    
  </ul>
</div>


  <div id="disqus_thread"></div>
  <script>
      /**
      *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
      *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables    */
      /*
      var disqus_config = function () {
      this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
      this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
      };
      */
      (function() { // DON'T EDIT BELOW THIS LINE
      var d = document, s = d.createElement('script');
      s.src = 'https://yujaeseo-github-io.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
      })();


    // const content = document.querySelector(".main-content");

    // scrollnav.init(content,{
    //   debug: false,
    //   easingStyle: 'easeOutQuint',
    //   sections: ($('.post-content > h1').length>0) ? 'h1' : 'h2',
    //   subSections: ($('.post-content > h1').length>0) ? 'h2' : 'h3'
    // });

    // var sideNav = function(){
    //   var mainRect = document.getElementById('main-content').getBoundingClientRect();
    //   $('nav.scroll-nav').css('left', mainRect.right + 50 + 'px');
    // }

    // sideNav();
    // window.addEventListener("resize", sideNav);

</script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>


      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

  </body>
  <script>
    const content = document.querySelector(".main-content");
    
    scrollnav.init(content,{
      debug: false,
      updateHistory: false,
      // easingStyle: 'easeOutQuint',
      sections: ($('.post-content > h1').length>0) ? 'h1' : 'h2',
      subSections: ($('.post-content > h1').length>0) ? 'h2' : 'h3'
    });
    
    var sideNav = function(){
      var mainRect = document.getElementById('main-content').getBoundingClientRect();
      $('nav.scroll-nav').css('left', mainRect.right + 50 + 'px');
    }
    
    sideNav();
    window.addEventListener("resize", sideNav);
    
   

    
    // window.addEventListener('load', (event) => {
    //   console.log('page is fully loaded');
    //   scrollnav.updatePositions();
  
    // });

  </script>
</html>
